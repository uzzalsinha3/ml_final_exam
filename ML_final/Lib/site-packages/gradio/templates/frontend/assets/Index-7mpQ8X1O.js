const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./embed-CG2e9My5.js","./mollweide-BhZ4OpW6.js","./ordinal-BeghXfj9.js","./init-Dmth1JHB.js","./linear-CM32Lqs5.js","./step-ChYay-CR.js","./defaultLocale-CNpUPyHh.js","./time-CCMAgbNn.js","./dispatch-kxCwF96_.js","./range-OtVwhkKS.js","./index-BU4IRnz1.js","./colors-Cc3OSVma.js","./dsv-DB8NKgIY.js","./arc-CSo4ybba.js"])))=>i.map(i=>d[i]);
import{_ as ae}from"./index-Ds2meNS5.js";import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import"./i18n-BldJSFLV.js";import{G as pe}from"./utils.svelte-Ceck75cM.js";import{B as de,e as ue,c as fe,I as ge,D as ce,E as _e,L as me}from"./IconButtonWrapper-Cljb5D-5.js";import"./svelte/svelte_internal_flags_legacy.js";import{onMount as ve,untrack as he}from"./svelte/svelte_svelte.js";import{F as ye}from"./FullscreenButton-Cqzqqtq6.js";import{S as be}from"./StreamingBar-b2qVLPYU.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_store.js";import"./svelte/svelte_transition.js";import"./svelte/svelte_events.js";import"./MarkdownCode-C2b9iIxl.js";import"./prism-python-CpYAgONt.js";var xe=e.from_html("<!> <!>",1),ke=e.from_html('<p class="caption svelte-19utvcn"> </p>'),we=e.from_html('<div class="svelte-19utvcn"></div> <!>',1),$e=e.from_html("<!> <!> <!> <!>",1);function Je(Q,G){e.push(G,!0);let Z=e.rest_props(G,["$$slots","$$events","$$legacy"]);const t=new pe(Z);let U=e.derived(()=>t.props.color&&t.props.value&&t.props.value.datatypes[t.props.color]==="nominal"?Array.from(new Set(e.get(S).map(r=>r[t.props.color]))):[]),I=e.derived(()=>t.props.x_lim||null),z=e.derived(()=>t.props.y_lim||null),O=e.derived(()=>e.get(I)?.[0]!==null?e.get(I)?.[0]:void 0),A=e.derived(()=>e.get(I)?.[1]!==null?e.get(I)?.[1]:void 0),Y=e.derived(()=>e.get(z)?.[0]!==null?e.get(z)?.[0]:void 0),q=e.derived(()=>e.get(z)?.[1]!==null?e.get(z)?.[1]:void 0),k=e.state(!1);function ee(r){if(r==="x")return"ascending";if(r==="-x")return"descending";if(r==="y")return{field:t.props.y,order:"ascending"};if(r==="-y")return{field:t.props.y,order:"descending"};if(r===null)return null;if(Array.isArray(r))return r}let te=e.derived(()=>ee(t.props.sort)),S=e.state(e.proxy([]));function P(r){return r.replace(/\./g,"\\.").replace(/\[/g,"\\[").replace(/\]/g,"\\]")}let L=e.derived(()=>t.props.value&&t.props.value.datatypes[t.props.x]==="temporal"),W=e.derived(()=>e.get(L)?[e.get(O)!==void 0?e.get(O)*1e3:null,e.get(A)!==void 0?e.get(A)*1e3:null]:e.get(I)),N=e.state(!1);const re={s:1,m:60,h:3600,d:1440*60};let w=e.derived(()=>t.props.x_bin?typeof t.props.x_bin=="string"?1e3*parseInt(t.props.x_bin.substring(0,t.props.x_bin.length-1))*re[t.props.x_bin[t.props.x_bin.length-1]]:t.props.x_bin:void 0),j=e.derived(()=>{if(t.props.value)if(t.props.value.mark==="point"){const r=e.get(w)!==void 0;return t.props.y_aggregate||r?"sum":void 0}else return t.props.y_aggregate?t.props.y_aggregate:"sum"}),J=e.derived(()=>t.props.value?t.props.value.mark==="point"?e.get(w)!==void 0:e.get(w)!==void 0||t.props.value.datatypes[t.props.x]==="nominal":!1);function X(r,s,f,l,m,d){if(r.length<1e3||t.props.x_bin!==null||t.props.value?.mark!=="line"||t.props.value?.datatypes[t.props.x]==="nominal")return r;const g=250;let i={};if((m===void 0||d===void 0)&&r.forEach(o=>{let a=o[s];(m===void 0||a<m)&&(m=a),(d===void 0||a>d)&&(d=a)}),m===void 0||d===void 0)return r;const u=(d-m)/g;r.forEach((o,a)=>{const v=o[s],_=o[f],p=l!==null?o[l]:"any",n=Math.floor((v-m)/u);i[p]===void 0&&(i[p]=[]),i[p][n]=i[p][n]||[null,Number.POSITIVE_INFINITY,null,Number.NEGATIVE_INFINITY],_<i[p][n][1]&&(i[p][n][0]=a,i[p][n][1]=_),_>i[p][n][3]&&(i[p][n][2]=a,i[p][n][3]=_)});const x=[];return Object.values(i).forEach(o=>{o.forEach(([a,v,_,p])=>{let n=[];a!==null&&_!==null?n=[Math.min(a,_),Math.max(a,_)]:a!==null?n=[a]:_!==null&&(n=[_]),n.forEach($=>{x.push(r[$])})})}),x}function oe(r,s,f){let l=r.columns.indexOf(t.props.x),m=r.columns.indexOf(t.props.y),d=t.props.color?r.columns.indexOf(t.props.color):null,g=r.data;if(s!==void 0&&f!==void 0){const i=r.datatypes[t.props.x]==="temporal"?1e3:1,c=s*i,u=f*i;let x={},o={};const a=g.filter((v,_)=>{const p=v[l],n=d!==null?v[d]:"any";return p<c&&(x[n]===void 0||p>x[n][1])&&(x[n]=[_,p]),p>u&&(o[n]===void 0||p<o[n][1])&&(o[n]=[_,p]),p>=c&&p<=u});g=[...Object.values(x).map(([v,_])=>g[v]),...X(a,l,m,d,c,u),...Object.values(o).map(([v,_])=>g[v])]}else g=X(g,l,m,d,void 0,void 0);return t.props.tooltip=="all"||Array.isArray(t.props.tooltip)?g.map(i=>{const c={};return r.columns.forEach((u,x)=>{c[u]=i[x]}),c}):g.map(i=>{const c={[t.props.x]:i[l],[t.props.y]:i[m]};return t.props.color&&d!==null&&(c[t.props.color]=i[d]),c})}e.user_effect(()=>{e.set(S,t.props.value?oe(t.props.value,e.get(O),e.get(A)):[],!0)});let K=e.state(e.proxy(t.props.value));e.user_effect(()=>{e.get(K)!==t.props.value&&e.get(h)&&(e.set(K,t.props.value,!0),e.get(h).data("data",e.get(S)).runAsync())});const le=typeof window<"u";let y=e.state(void 0),b=e.derived(()=>e.get(y)?window.getComputedStyle(e.get(y)):null),h=e.state(void 0),M=e.state(!1),T=e.state(0),D=e.state(0),C=e.state(void 0),H;async function V(){if(e.get(N)){e.set(B,!0);return}if(e.get(h)&&e.get(h).finalize(),!t.props.value||!e.get(y))return;e.set(T,e.get(y).offsetWidth,!0),e.set(D,e.get(y).offsetHeight,!0);const r=ie();r&&(e.set(C,new ResizeObserver(s=>{if(!(!s[0].target||!(s[0].target instanceof HTMLElement)))if(e.get(T)===0&&e.get(y).offsetWidth!==0&&t.props.value.datatypes[t.props.x]==="nominal")V();else{const f=Math.abs(e.get(T)-s[0].target.offsetWidth),l=Math.abs(e.get(D)-s[0].target.offsetHeight);f>100||l>100?(e.set(T,s[0].target.offsetWidth,!0),e.set(D,s[0].target.offsetHeight,!0),V()):(e.get(h).signal("width",s[0].target.offsetWidth).run(),e.get(k)&&e.get(h).signal("height",s[0].target.offsetHeight).run())}}),!0),H||(H=(await ae(async()=>{const{default:s}=await import("./embed-CG2e9My5.js");return{default:s}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url)).default),H(e.get(y),r,{actions:!1}).then(function(s){e.set(h,s.view,!0),e.get(C).observe(e.get(y));var f,l=0;e.get(h).addEventListener("dblclick",()=>{t.dispatch("double_click")}),e.get(y).addEventListener("mousedown",function(m){m.detail>1&&m.preventDefault()},!1),t.props._selectable&&e.get(h).addSignalListener("brush",function(m,d){if(Date.now()-l<1e3||(e.set(N,!0),Object.keys(d).length===0))return;clearTimeout(f);let g=d[Object.keys(d)[0]];e.get(L)&&(g=[g[0]/1e3,g[1]/1e3]),f=setTimeout(function(){e.set(N,!1),l=Date.now(),t.dispatch("select",{value:g,index:g,selected:!0}),e.get(B)&&(e.set(B,!1),V())},250)})}))}let B=e.state(!1);ve(()=>(e.set(M,!0),()=>{e.set(M,!1),e.get(h)&&e.get(h).finalize(),e.get(C)&&e.get(C).disconnect()}));function ne(){if(!e.get(h)||!e.get(b))return;const s=e.get(b).getPropertyValue("--block-background-fill")||"white";e.get(h).background(s).run(),e.get(h).toImageURL("png",2).then(function(f){e.get(h).background("transparent").run();const l=document.createElement("a");l.setAttribute("href",f),l.setAttribute("download","chart.png"),l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l)}).catch(function(f){console.error("Export failed:",f),e.get(h).background("transparent").run()})}let se=e.derived(()=>JSON.stringify(t.props.color_map));e.user_effect(()=>{t.props.title,t.props.x_title,t.props.y_title,t.props.color_title,t.props.x,t.props.y,t.props.color,t.props.x_bin,e.get(j),e.get(se),t.props.colors_in_legend,e.get(O),e.get(A),e.get(Y),e.get(q),t.props.caption,t.props.sort,e.get(M),e.get(y),e.get(k),e.get(b),e.get(M)&&e.get(y)&&he(()=>{V()})});function ie(){if(!t.props.value||!e.get(b))return null;let r=e.get(b).getPropertyValue("--color-accent"),s=e.get(b).getPropertyValue("--body-text-color"),f=e.get(b).getPropertyValue("--border-color-primary"),l=e.get(b).fontFamily,m=e.get(b).getPropertyValue("--block-title-text-weight");const d=c=>c.endsWith("px")?parseFloat(c.slice(0,-2)):12;let g=d(e.get(b).getPropertyValue("--text-md")),i=d(e.get(b).getPropertyValue("--text-sm"));return{$schema:"https://vega.github.io/schema/vega-lite/v5.17.0.json",background:"transparent",config:{autosize:{type:"fit",contains:"padding"},axis:{labelFont:l,labelColor:s,titleFont:l,titleColor:s,titlePadding:8,tickColor:f,labelFontSize:i,gridColor:f,titleFontWeight:"normal",titleFontSize:i,labelFontWeight:"normal",domain:!1,labelAngle:0,titleLimit:e.get(y).offsetHeight*.8},legend:{labelColor:s,labelFont:l,titleColor:s,titleFont:l,titleFontWeight:"normal",titleFontSize:i,labelFontWeight:"normal",offset:2},title:{color:s,font:l,fontSize:g,fontWeight:m,anchor:"middle"},view:{stroke:f},mark:{stroke:t.props.value.mark!=="bar"?r:void 0,fill:t.props.value.mark==="bar"?r:void 0,cursor:"crosshair"}},data:{name:"data"},datasets:{data:e.get(S)},layer:["plot",...t.props.value.mark==="line"?["hover"]:[]].map(c=>({encoding:{size:t.props.value.mark==="line"?c=="plot"?{condition:{empty:!1,param:"hoverPlot",value:3},value:2}:{condition:{empty:!1,param:"hover",value:100},value:0}:void 0,opacity:c==="plot"?void 0:{condition:{empty:!1,param:"hover",value:1},value:0},x:{axis:{...t.props.x_label_angle!==null&&{labelAngle:t.props.x_label_angle},labels:t.props.x_axis_labels_visible,ticks:t.props.x_axis_labels_visible},field:P(t.props.x),title:t.props.x_title||t.props.x,type:t.props.value.datatypes[t.props.x],scale:{zero:!1,domainMin:e.get(W)?.[0]!==null?e.get(W)?.[0]:void 0,domainMax:e.get(W)?.[1]!==null?e.get(W)?.[1]:void 0},bin:e.get(w)?{step:e.get(w)}:void 0,sort:e.get(te)},y:{axis:t.props.y_label_angle?{labelAngle:t.props.y_label_angle}:{},field:P(t.props.y),title:t.props.y_title||t.props.y,type:t.props.value.datatypes[t.props.y],scale:{zero:!1,domainMin:e.get(Y)??void 0,domainMax:e.get(q)??void 0},aggregate:e.get(J)?e.get(j):void 0},color:t.props.color?{field:P(t.props.color),legend:{orient:"bottom",title:t.props.color_title,values:t.props.colors_in_legend?.length?[...t.props.colors_in_legend]:void 0},scale:t.props.value.datatypes[t.props.color]==="nominal"?{domain:e.get(U),range:t.props.color_map?e.get(U).map(u=>t.props.color_map[u]):void 0}:{range:[100,200,300,400,500,600,700,800,900].map(u=>e.get(b).getPropertyValue("--primary-"+u)),interpolate:"hsl"},type:t.props.value.datatypes[t.props.color]}:void 0,tooltip:t.props.tooltip=="none"?void 0:[{field:P(t.props.y),type:t.props.value.datatypes[t.props.y],aggregate:e.get(J)?e.get(j):void 0,title:t.props.y_title||t.props.y},{field:P(t.props.x),type:t.props.value.datatypes[t.props.x],title:t.props.x_title||t.props.x,format:e.get(L)?"%Y-%m-%d %H:%M:%S":void 0,bin:e.get(w)?{step:e.get(w)}:void 0},...t.props.color?[{field:t.props.color,type:t.props.value.datatypes[t.props.color]}]:[],...t.props.tooltip==="axis"?[]:t.props.value?.columns.filter(u=>u!==t.props.x&&u!==t.props.y&&u!==t.props.color&&(t.props.tooltip==="all"||t.props.tooltip.includes(u))).map(u=>({field:u,type:t.props.value.datatypes[u]}))]},strokeDash:{},mark:{clip:!0,type:c==="hover"?"point":t.props.value.mark},name:c})),params:[...t.props.value.mark==="line"?[{name:"hoverPlot",select:{clear:"mouseout",fields:t.props.color?[t.props.color]:[],nearest:!0,on:"mouseover",type:"point"},views:["hover"]},{name:"hover",select:{clear:"mouseout",nearest:!0,on:"mouseover",type:"point"},views:["hover"]}]:[],...t.props._selectable?[{name:"brush",select:{encodings:["x"],mark:{fill:"gray",fillOpacity:.3,stroke:"none"},type:"interval"},views:["plot"]}]:[]],width:e.get(y).offsetWidth,height:t.props.height||e.get(k)?"container":void 0,title:t.props.title||void 0}}de(Q,{get visible(){return t.shared.visible},get elem_id(){return t.shared.elem_id},get elem_classes(){return t.shared.elem_classes},get scale(){return t.shared.scale},get min_width(){return t.shared.min_width},allow_overflow:!1,padding:!0,get height(){return t.props.height},get fullscreen(){return e.get(k)},set fullscreen(r){e.set(k,r,!0)},children:(r,s)=>{var f=$e(),l=e.first_child(f);{var m=o=>{be(o,e.spread_props({get autoscroll(){return t.shared.autoscroll},get i18n(){return t.i18n}},()=>t.shared.loading_status,{on_clear_status:()=>t.dispatch("clear_status",t.shared.loading_status)}))};e.if(l,o=>{t.shared.loading_status&&o(m)})}var d=e.sibling(l,2);{var g=o=>{fe(o,{get buttons(){return t.props.buttons},on_custom_button_click:a=>{t.dispatch("custom_button_click",{id:a})},children:(a,v)=>{var _=xe(),p=e.first_child(_);{var n=E=>{ge(E,{get Icon(){return ce},label:"Export",$$events:{click:ne}})};e.if(p,E=>{t.props.buttons?.some(F=>typeof F=="string"&&F==="export")&&E(n)})}var $=e.sibling(p,2);{var R=E=>{ye(E,{get fullscreen(){return e.get(k)},$$events:{fullscreen:({detail:F})=>{e.set(k,F,!0)}}})};e.if($,E=>{t.props.buttons?.some(F=>typeof F=="string"&&F==="fullscreen")&&E(R)})}e.append(a,_)},$$slots:{default:!0}})};e.if(d,o=>{t.props.buttons?.length&&o(g)})}var i=e.sibling(d,2);ue(i,{get show_label(){return t.shared.show_label},info:void 0,children:(o,a)=>{e.next();var v=e.text();e.template_effect(()=>e.set_text(v,t.shared.label)),e.append(o,v)},$$slots:{default:!0}});var c=e.sibling(i,2);{var u=o=>{var a=we(),v=e.first_child(a);e.bind_this(v,n=>e.set(y,n),()=>e.get(y));var _=e.sibling(v,2);{var p=n=>{var $=ke(),R=e.child($,!0);e.reset($),e.template_effect(()=>e.set_text(R,t.props.caption)),e.append(n,$)};e.if(_,n=>{t.props.caption&&n(p)})}e.append(o,a)},x=o=>{_e(o,{unpadded_box:!0,children:(a,v)=>{me(a)},$$slots:{default:!0}})};e.if(c,o=>{t.props.value&&le?o(u):o(x,!1)})}e.append(r,f)},$$slots:{default:!0}}),e.pop()}export{Je as default};
